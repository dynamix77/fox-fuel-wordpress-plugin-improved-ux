/**\n * Fox Fuel Admin JavaScript\n * Handles Google Sheets integration admin interface\n */\n\njQuery(document).ready(function($) {\n    // Initialize tabs\n    $(\"#fox-fuel-admin-tabs\").tabs();\n    \n    // Google Sheets Test Connection\n    $(\"#test-sheets-connection\").click(function() {\n        var button = $(this);\n        var resultDiv = $(\"#sheets-test-results\");\n        \n        button.prop(\"disabled\", true).text(foxFuelAdmin.strings.testing);\n        resultDiv.html(\"<p>Testing connection to Google Sheets...</p>\");\n        \n        $.ajax({\n            url: foxFuelAdmin.ajaxurl,\n            method: \"POST\",\n            data: {\n                action: \"fox_fuel_test_sheets\",\n                nonce: foxFuelAdmin.nonce\n            },\n            success: function(response) {\n                if (response.success) {\n                    resultDiv.html(\"<div class='notice notice-success'><p>\" + response.data.message + \"</p></div>\");\n                    if (response.data.preview) {\n                        resultDiv.append(\"<h4>Data Preview:</h4><pre style='background: #f1f1f1; padding: 10px; border-radius: 4px; overflow-x: auto;'>\" + JSON.stringify(response.data.preview, null, 2) + \"</pre>\");\n                    }\n                } else {\n                    resultDiv.html(\"<div class='notice notice-error'><p>\" + response.data.message + \"</p></div>\");\n                }\n            },\n            error: function(xhr, status, error) {\n                console.error('Test connection error:', error);\n                resultDiv.html(\"<div class='notice notice-error'><p>\" + foxFuelAdmin.strings.connectionFailed + \" (\" + error + \")</p></div>\");\n            },\n            complete: function() {\n                button.prop(\"disabled\", false).text(foxFuelAdmin.strings.testConnection);\n            }\n        });\n    });\n    \n    // Google Sheets Manual Sync\n    $(\"#manual-sync-sheets\").click(function() {\n        var button = $(this);\n        var resultDiv = $(\"#sheets-test-results\");\n        \n        button.prop(\"disabled\", true).text(foxFuelAdmin.strings.syncing);\n        resultDiv.html(\"<p>Syncing pricing data from Google Sheets...</p>\");\n        \n        $.ajax({\n            url: foxFuelAdmin.ajaxurl,\n            method: \"POST\",\n            data: {\n                action: \"fox_fuel_sync_sheets\",\n                nonce: foxFuelAdmin.nonce\n            },\n            success: function(response) {\n                if (response.success) {\n                    resultDiv.html(\"<div class='notice notice-success'><p>\" + response.data.message + \"</p></div>\");\n                    // Show last sync time if available\n                    if (response.data.last_sync) {\n                        resultDiv.append(\"<p><em>Last sync: \" + response.data.last_sync + \"</em></p>\");\n                    }\n                    // Refresh page after 2 seconds to show updated status\n                    setTimeout(function() {\n                        location.reload();\n                    }, 2000);\n                } else {\n                    resultDiv.html(\"<div class='notice notice-error'><p>\" + response.data.message + \"</p></div>\");\n                }\n            },\n            error: function(xhr, status, error) {\n                console.error('Manual sync error:', error);\n                resultDiv.html(\"<div class='notice notice-error'><p>\" + foxFuelAdmin.strings.syncFailed + \" (\" + error + \")</p></div>\");\n            },\n            complete: function() {\n                button.prop(\"disabled\", false).text(foxFuelAdmin.strings.syncNow);\n            }\n        });\n    });\n    \n    // View Sync Log\n    $(\"#view-sync-log\").click(function() {\n        var resultDiv = $(\"#sheets-test-results\");\n        \n        resultDiv.html(\"<p>Loading sync log...</p>\");\n        \n        $.ajax({\n            url: foxFuelAdmin.ajaxurl,\n            method: \"POST\",\n            data: {\n                action: \"fox_fuel_get_sync_log\",\n                nonce: foxFuelAdmin.nonce\n            },\n            success: function(response) {\n                if (response.success && response.data.log && response.data.log.length > 0) {\n                    var logHtml = \"<h4>Recent Sync Log (\" + response.data.count + \" entries):</h4>\";\n                    logHtml += \"<div style='background: #f9f9f9; border: 1px solid #ddd; padding: 15px; max-height: 400px; overflow-y: auto; border-radius: 4px;'>\";\n                    \n                    response.data.log.forEach(function(entry) {\n                        var levelClass = entry.level === \"error\" ? \"color: #d63638; font-weight: bold;\" : \"color: #00a32a;\";\n                        var icon = entry.level === \"error\" ? \"❌\" : \"✅\";\n                        logHtml += \"<div style='margin-bottom: 10px; padding: 8px; background: white; border-left: 4px solid \" + (entry.level === \"error\" ? \"#d63638\" : \"#00a32a\") + \"; border-radius: 2px;'>\";\n                        logHtml += \"<div style='\" + levelClass + \"'>\" + icon + \" <strong>\" + entry.timestamp + \"</strong></div>\";\n                        logHtml += \"<div style='margin-top: 4px; color: #333;'>\" + entry.message + \"</div>\";\n                        logHtml += \"</div>\";\n                    });\n                    \n                    logHtml += \"</div>\";\n                    resultDiv.html(logHtml);\n                } else {\n                    resultDiv.html(\"<div class='notice notice-info'><p>No sync log entries found. Try running a sync first.</p></div>\");\n                }\n            },\n            error: function(xhr, status, error) {\n                console.error('Sync log error:', error);\n                resultDiv.html(\"<div class='notice notice-error'><p>\" + foxFuelAdmin.strings.logFailed + \" (\" + error + \")</p></div>\");\n            }\n        });\n    });\n    \n    // Auto-hide admin notices after 5 seconds\n    setTimeout(function() {\n        $('.notice.is-dismissible').fadeOut();\n    }, 5000);\n    \n    // Form validation for Google Sheets URL\n    $('input[name=\"fox_fuel_sheets_config[sheets_url]\"]').on('blur', function() {\n        var url = $(this).val();\n        if (url && !url.match(/docs\\.google\\.com\\/spreadsheets/)) {\n            $(this).after('<div class=\"inline-notice notice-warning\" style=\"margin-top: 5px; padding: 5px 10px; background: #fff3cd; border-left: 4px solid #ffc107;\"><p>Please ensure this is a valid Google Sheets URL.</p></div>');\n        } else {\n            $(this).siblings('.inline-notice').remove();\n        }\n    });\n    \n    // Show/hide API key field based on usage\n    $('input[name=\"fox_fuel_sheets_config[api_key]\"]').after('<p class=\"description\"><strong>Tip:</strong> API key is optional. The plugin will use CSV export method if no API key is provided.</p>');\n});